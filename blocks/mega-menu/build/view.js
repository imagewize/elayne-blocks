import{getContext as e,getElement as n,store as t,withScope as o}from"@wordpress/interactivity";const{state:s,actions:i}=t("elayne/mega-menu",{state:{get isMenuOpen(){return e().isOpen||!1},get isMobile(){return window.innerWidth<768}},actions:{toggleMenu(){e().isOpen?i.closeMenu():i.openMenu()},toggleMenuOnClick(){const t=e(),{ref:o}=n();t.menuOpenedBy.click||t.menuOpenedBy.focus?i.closeMenu():(t.previousFocus=o,i.openMenu("click"))},closeMenuOnClick(){i.closeMenu("click"),i.closeMenu("focus")},handleMenuKeydown(n){const t=e();if("Escape"===n?.key&&t.isOpen&&(i.closeMenu(),n.preventDefault()),"Tab"===n?.key&&t.isOpen){const{layoutMode:e}=t;if("overlay"===e){const{firstFocusable:e,lastFocusable:o}=t;n.shiftKey&&document.activeElement===e?(n.preventDefault(),o?.focus()):n.shiftKey||document.activeElement!==o||(n.preventDefault(),e?.focus())}}t.menuOpenedBy?.click&&"Escape"===n?.key&&i.closeMenuOnClick()},handleOutsideClick(t){const o=e(),{ref:s}=n();if(!o.isOpen)return;s.contains(t.target)||i.closeMenu();const l=o?.megaMenu;l&&!l.contains(t.target)&&i.closeMenuOnClick()},openMenu(t="click"){const o=e(),{ref:s}=n(),{layoutMode:l}=o;"overlay"===l&&document.body.classList.add("mega-menu-overlay-open"),i.positionFullWidthPanel(),o.isOpen=!0,t&&o.menuOpenedBy&&(o.menuOpenedBy[t]=!0),o.animationSpeed&&s.style.setProperty("--mm-animation-speed",`${o.animationSpeed}ms`),i.setFocusTrap()},closeMenu(n="click"){const t=e(),{layoutMode:o}=t;t.isOpen=!1,n&&t.menuOpenedBy&&(t.menuOpenedBy[n]=!1),"overlay"===o&&document.body.classList.remove("mega-menu-overlay-open"),i.returnFocus()},setFocusTrap(){const t=e(),{ref:s}=n(),i=s.querySelector(".wp-block-elayne-mega-menu__panel");if(!i)return;const l=i.querySelectorAll('a[href], button, input, textarea, select, [tabindex]:not([tabindex="-1"])');t.firstFocusable=l[0],t.lastFocusable=l[l.length-1],setTimeout(o(()=>{const n=e();n.firstFocusable?.focus()}),100)},returnFocus(){const{ref:e}=n(),t=e.querySelector(".wp-block-elayne-mega-menu__trigger");t?.focus()},updateMobileState(){const n=e(),t=n.mobileBreakpoint||768;n.isMobile=window.innerWidth<t},positionFullWidthPanel(){const{ref:e}=n(),t=e.querySelector(".wp-block-elayne-mega-menu__panel.mm-full-width");if(!t)return;const o=e.closest(".wp-block-navigation");if(!o)return;const s=o.getBoundingClientRect(),i=getComputedStyle(e),l=parseInt(i.getPropertyValue("--mm-dropdown-spacing"))||16,c=s.bottom+l,a=s.left;t.style.top=`${c}px`,t.style.left=`${a}px`,t.style.transform="none",t.style.width=`${s.width}px`}},callbacks:{initMenu(){const t=e(),{ref:l}=n();s.isMenuOpen&&(t.megaMenu=l),i.updateMobileState(),i.positionFullWidthPanel(),t.resizeListenerAdded||(window.addEventListener("resize",o(()=>{i.updateMobileState(),i.positionFullWidthPanel()})),t.resizeListenerAdded=!0)}}});