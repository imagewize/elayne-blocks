import{getContext as e,getElement as n,store as o}from"@wordpress/interactivity";const{state:t,actions:i}=o("elayne/mega-menu",{state:{get isMenuOpen(){return Object.values(t.menuOpenedBy).filter(Boolean).length>0},get menuOpenedBy(){return e().menuOpenedBy||{}}},actions:{toggleMenuOnClick(){const o=e(),{ref:t}=n();o.menuOpenedBy.click||o.menuOpenedBy.focus?i.closeMenuOnClick():(o.previousFocus=t,i.openMenu("click"))},closeMenuOnClick(){i.closeMenu("click"),i.closeMenu("focus")},handleMenuKeydown(n){e().menuOpenedBy.click&&"Escape"===n?.key&&i.closeMenuOnClick()},handleOutsideClick(n){const o=e(),t=o?.megaMenu;t&&!t.contains(n.target)&&i.closeMenuOnClick()},openMenu(o="click"){const t=e(),{layoutMode:s}=t;switch(s){case"overlay":i.openOverlay();break;case"sidebar":i.openSidebar();break;case"grid":i.openGrid();break;default:i.openDropdown()}if(t.menuOpenedBy[o]=!0,t.animationSpeed){const{ref:e}=n();e.style.setProperty("--mm-animation-speed",`${t.animationSpeed}ms`)}},openOverlay(){document.body.classList.add("mm-overlay-open"),document.body.style.overflow="hidden"},openSidebar(){document.body.classList.add("mm-sidebar-open"),e().isMobile&&i.initSwipeHandler()},openDropdown(){},openGrid(){},closeMenu(n="click"){const o=e();o.menuOpenedBy[n]=!1,t.isMenuOpen||(document.body.classList.remove("mm-overlay-open","mm-sidebar-open"),document.body.style.overflow="",o.megaMenu?.contains(window.document.activeElement)&&o.previousFocus?.focus(),o.previousFocus=null,o.megaMenu=null)},initSwipeHandler(){const o=e(),{ref:t}=n();let s=0,c=0;const a=t.querySelector(".elayne-mega-menu, .wp-block-elayne-mega-menu__menu-container");a&&(a.addEventListener("touchstart",e=>{s=e.touches[0].clientX},{passive:!0}),a.addEventListener("touchend",e=>{c=e.changedTouches[0].clientX,(()=>{const e=c-s;if(Math.abs(e)>50){const{sidebarDirection:n}=o;("left"===n&&e<0||"right"===n&&e>0)&&i.closeMenuOnClick()}})()},{passive:!0}))}},callbacks:{initMenu(){const o=e(),{ref:s}=n();t.isMenuOpen&&(o.megaMenu=s),i.updateMobileState(),o.resizeListenerAdded||(window.addEventListener("resize",i.updateMobileState),o.resizeListenerAdded=!0)},updateMobileState(){const n=e(),o=n.mobileBreakpoint||768;n.isMobile=window.innerWidth<o}}});